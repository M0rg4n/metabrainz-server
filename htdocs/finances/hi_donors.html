%# vi: set ts=2 sw=2 ft=mason :
<%args>
$offset=>0
</%args>
<%perl>

my $items_per_page = 20;

my $mb = new MetaBrainz::Server::MetaBrainz(1);
$mb->Login();
my $don = MetaBrainz::Server::Donation->new($mb->{DBH});
my ($total, $donations) = $don->GetHighestDonations($offset, $items_per_page);
my ($total_don, $total_fee) = (0, 0);

</%perl>
<& /comp/sidebar, title=>'Highest Donors', expand=>'finances' &>

% if ($total > $items_per_page) {
  <div class="BlueBox">
  <& /comp/pageselector, offset=>$offset, pagesize=>$items_per_page, url=>'/finances/hi_donors.html',
                         args=>{}, numitems=>$total  &>
  </div>
% }

<table width="100%" class="donors">
     <tr>
       <td><b>Donor (moderator)</b></td>
       <td><b>Fee</b></td>
       <td><b>Amount</b></td>
     </tr>
% foreach my $item (@$donations) {
%    $total_don += $item->{amount}; $total_fee += $item->{fee};
     <tr class="donors<% ("odd", "even")[++$. % 2] %>">
       <td width="80%" valign="top">
%      if ($item->{anon}) {
            Anonymous
%      } else {
            <b><% $item->{first_name} %> <% $item->{last_name} %></b>
%           if ($item->{moderator}) {
                ( <a href="http://musicbrainz.org/user/view.html?modname=<% $item->{moderator} %>"><%
                   $item->{moderator} %></a> )
%           } 
%           if ($item->{memo}) {
                <br>Note: <% $item->{memo} %>
%           } 
%      } 
       </td>
       <td align="right" valign="top">$&nbsp;<% sprintf "%.2f", $item->{fee} %></td>
       <td align="right" valign="top">$&nbsp;<% sprintf "%.2f", $item->{amount} %></td>
     </tr>
% }
     <tr class="donorseven">
       <td align="right">Total this page:</td>
       <td align="right" valign="top"><b>$&nbsp;<% sprintf "%.2f", $total_fee %></b></td>
       <td align="right" valign="top"><b>$&nbsp;<% sprintf "%.2f", $total_don %></b></td>
     </tr>
</table>

<p>
Note: The fee column shows any fees that were incurred while accepting the donation (e.g. PayPal transaction fee).
</p>

<& /comp/footer &>
